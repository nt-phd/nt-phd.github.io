<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


    <script>

function removeOptionSix(formData) {
    for (let [key, value] of formData.entries()) {
        if (value === "6") {
            formData.delete(key); // Rimuove completamente l'opzione 6
        }
    }
}


        document.addEventListener("DOMContentLoaded", function () {
            const questions = [
                {
                    label: "1. Lo scompenso cardiaco influisce su persone diverse in modo diverso. Alcuni hanno difficoltà a respirare mentre altri si sentono stanchi. Per cortesia indichi quanto lo scompenso cardiaco (difficoltà a respirare o stanchezza) ha limitato la sua capacità di fare le seguenti attività nelle ultime 2 settimane.",
                    activities: ["Vestirsi", "Fare il bagno o la doccia", "Camminare in piano per circa 100 metri", "Fare piccoli lavori di giardinaggio o intorno alla casa, lavori domestici, portare la spesa", "Fare una decina di scalini a piedi senza fermarsi", "Affrettarsi o correre (come per prendere l’autobus)"],
                    options: ["Estremamente limitato", "Molto limitato", "Moderatamente limitato", "Poco limitato", "Per niente limitato", "Limitato per altre ragioni"]
                },
                {
                    label: "2. Rispetto a 2 settimane fa i suoi sintomi di scompenso cardiaco (difficoltà a respirare, stanchezza o gonfiore alle caviglie) sono cambiati?",
                    options: ["Molto peggiorati", "Un po' peggiorati", "Non sono cambiati", "Un po' migliorati", "Molto migliorati", "Nessun sintomo nelle ultime 2 settimane"]
                },
                {
                    label: "3. Nelle ultime 2 settimane, quante volte si è alzato/a la mattina con i piedi, le caviglie o le gambe gonfie?",
                    options: ["Ogni mattina", "3 o più volte alla settimana ma non ogni giorno", "1 o 2 volte alla settimana", "Meno di 1 volta alla settimana", "Mai nelle ultime 2 settimane"]
                },
                {
                    label: "4. Nelle ultime 2 settimane, quanto le ha dato fastidio il gonfiore ai piedi, alle caviglie o alle gambe?",
                    options: ["Estremamente fastidio", "Molto fastidio", "Moderatamente fastidio", "Poco fastidio", "Per niente fastidio", "Non ho avuto gonfiore"]
                },
                {
                    label: "5. Nelle ultime 2 settimane, quante volte in media la stanchezza ha limitato la sua capacità di fare quello che desiderava?",
                    options: ["Sempre", "Parecchie volte al giorno", "Almeno 1 volta al giorno", "3 o più volte alla settimana", "1 o 2 volte alla settimana", "Meno di 1 volta alla settimana", "Mai nelle ultime 2 settimane"]
                },
                {
                    label: "6. Nelle ultime 2 settimane, quanto le ha dato fastidio sentirsi stanco/a?",
                    options: ["Estremamente fastidio", "Molto fastidio", "Moderatamente fastidio", "Poco fastidio", "Per niente fastidio", "Non mi sono sentito/a stanco/a"]
                },
                {
                    label: "7. Nelle ultime 2 settimane, quante volte in media la difficoltà a respirare ha limitato la sua capacità di fare quello che desiderava?",
                    options: ["Sempre", "Parecchie volte al giorno", "Almeno 1 volta al giorno", "3 o più volte alla settimana", "1 o 2 volte alla settimana", "Meno di 1 volta alla settimana", "Mai nelle ultime 2 settimane"]
                },
                {
                    label: "8. Nelle ultime 2 settimane, quanto le ha dato fastidio la difficoltà a respirare?",
                    options: ["Estremamente fastidio", "Molto fastidio", "Moderatamente fastidio", "Poco fastidio", "Per niente fastidio", "Non ho avuto difficoltà a respirare"]
                },
                {
                    label: "9. Nelle ultime 2 settimane, quante volte in media è stato/a costretto/a a dormire su una sedia o con almeno tre cuscini dietro la schiena a causa della difficoltà a respirare?",
                    options: ["Ogni notte", "3 o più volte alla settimana ma non ogni giorno", "1 o 2 volte alla settimana", "Meno di 1 volta alla settimana", "Mai nelle ultime 2 settimane"]
                },
                {
                    label: "10. I sintomi di scompenso cardiaco possono peggiorare per varie ragioni. In che misura è sicuro/a di sapere cosa fare o chi chiamare, se i suoi sintomi peggiorano?",
                    options: ["Per niente sicuro/a", "Non molto sicuro/a", "Abbastanza sicuro/a", "Quasi del tutto sicuro/a", "Completamente sicuro/a"]
                },
                {
                    label: "11. Quanto le è chiaro cosa può fare affinché i suoi sintomi di scompenso cardiaco non peggiorino (per esempio: pesarsi, mangiare con poco sale nella dieta, ecc.)?",
                    options: ["Per niente chiaro", "Non molto chiaro", "Abbastanza chiaro", "Quasi del tutto chiaro", "Completamente chiaro"]
                },
                {
                    label: "12. Nelle ultime 2 settimane, quanto lo scompenso cardiaco ha limitato il suo piacere di vivere?",
                    options: ["Ha limitato estremamente il mio piacere di vivere", "Ha limitato molto il mio piacere di vivere", "Ha limitato moderatamente il mio piacere di vivere", "Ha limitato poco il mio piacere di vivere", "Non ha limitato per niente il mio piacere di vivere"]
                },
                {
                    label: "13. Come si sentirebbe se sapesse di dover passare il resto della sua vita con lo scompenso cardiaco al livello in cui è adesso?",
                    options: ["Per niente soddisfatto/a", "Per lo più soddisfatto/a", "Abbastanza soddisfatto/a", "Quasi del tutto soddisfatto/a", "Completamente soddisfatto/a"]
                },
                {
                    label: "14. Nelle ultime 2 settimane, quanto spesso si è sentito/a scoraggiato/a o giù di morale a causa dello scompenso cardiaco?",
                    options: ["Mi sono sempre sentito/a così", "Mi sono sentito/a così spesso", "Mi sono sentito/a così qualche volta", "Mi sono sentito/a così raramente", "Non mi sono mai sentito/a così"]
                },
                {
                    label: "15. In che misura lo scompenso cardiaco influisce sul suo stile di vita? Per cortesia, indichi quanto lo scompenso cardiaco può aver limitato la sua partecipazione alle seguenti attività nelle ultime 2 settimane.",
                    activities: ["Passatempi, attività di svago", "Lavorare o fare dei lavori in casa", "Andare a trovare amici o familiari", "Relazioni intime con la persona amata"],
                    options: ["Estremamente limitato", "Molto limitato", "Moderatamente limitato", "Poco limitato", "Per niente limitato", "Non è il mio caso o non l’ho fatto per altre ragioni"]
                }
            ];

            const form = document.querySelector("form");
            const questionsContainer = document.getElementById("questions-container");

            questions.forEach((question, index) => {
                let questionDiv = document.createElement("div");
                questionDiv.classList.add("form-group");
                questionDiv.innerHTML = `<label><b>${question.label}</b></label>`;

                if (!question.activities) {

                    let optionsDiv = document.createElement("div");
                    optionsDiv.classList.add("m-2");

question.options.forEach(option => {
    let optionIndex = question.options.indexOf(option) + 1;
    let inputId = `q${index + 1}_option${optionIndex}`;

    let optionDiv = document.createElement("div");
    optionDiv.classList.add("form-check");
    optionDiv.style.marginLeft = "1rem";

    // Se l'opzione è 6 e appartiene ai domini q1 o q15
    if ((index === 0 || index === 14) && optionIndex === 6) {
        optionDiv.innerHTML = `
            <input class="form-check-input" type="radio" id="${inputId}" name="q${index + 1}" value="0">
            <label class="form-check-label text-muted" for="${inputId}" style="color: gray;">${option}</label>
        `;
    } else {
        optionDiv.innerHTML = `
            <input class="form-check-input" type="radio" id="${inputId}" name="q${index + 1}" value="${optionIndex}">
            <label class="form-check-label" for="${inputId}">${option}</label>
        `;
    }

    optionsDiv.appendChild(optionDiv);
});


                    questionDiv.appendChild(optionsDiv);
                }


                if (question.activities) {
                    let activityTable = document.createElement("div");
                    activityTable.classList.add("table-responsive");

                    let table = document.createElement("table");
                    table.classList.add("table", "table-hover");

                    let thead = document.createElement("thead");
                    let headers = `<thead><tr><th scope="col" style="font-weight: normal;">Attività</th>`;

                    question.options.forEach(option => {
                        headers += `<th scope="col" class="text-center" style="font-weight: normal;">${option}</th>`;
                    });
                    headers += `</tr></thead>`;

                    thead.innerHTML = headers;
                    table.appendChild(thead);

                    let tbody = document.createElement("tbody");

                    question.activities.forEach((activity, actIndex) => {
                        let row = `<tr><th scope="row">${activity}</th>`;
                        for (let i = 1; i <= question.options.length; i++) {
                            let inputId = `q${index + 1}_${actIndex + 1}_${i}`;
                            row += `<td class="text-center align-middle" style="cursor: pointer;" onclick="document.getElementById('${inputId}').checked = true;">
                <input class="form-check-input" type="radio" id="${inputId}" name="q${index + 1}_${actIndex + 1}" value="${i}">
            </td>`;
                        }
                        row += `</tr>`;
                        tbody.innerHTML += row;
                    });

                    table.appendChild(tbody);
                    activityTable.appendChild(table);
                    questionDiv.appendChild(activityTable);
                }




                questionsContainer.appendChild(questionDiv);
            });

            const resultBox = document.getElementById("result-box");

            function initializeFormData() {
                const inputs = document.querySelectorAll('input[type="radio"]');
                inputs.forEach(input => {
                    if (!input.checked) {
                        input.value = '0';
                    }
                });
            }




            form.addEventListener("submit", function (event) {
                event.preventDefault();
                let formData = new FormData(form);

                let domainScores = {
                    'physical_limitations': 0,
                    'symptoms': 0,
                    'self_efficacy_and_knowledge': 0,
                    'quality_of_life': 0,
                    'social_interference': 0
                };

                let domainQuestions = {
                    'physical_limitations': ['q1_1', 'q1_2', 'q1_3', 'q1_4', 'q1_5', 'q1_6'],
                    'symptoms': ['q2', 'q3', 'q4', 'q5', 'q6', 'q7', 'q8', 'q9'],
                    'self_efficacy_and_knowledge': ['q10', 'q11'],
                    'quality_of_life': ['q12', 'q13', 'q14'],
                    'social_interference': ['q15_1', 'q15_2', 'q15_3', 'q15_4']
                };

                let domainCounts = {
                    'physical_limitations': 0,
                    'symptoms': 0,
                    'self_efficacy_and_knowledge': 0,
                    'quality_of_life': 0,
                    'social_interference': 0
                };

                // Assign default values for unanswered questions
                Object.keys(domainQuestions).forEach(domain => {
                    domainQuestions[domain].forEach(question => {
                        if (!formData.has(question) || formData.get(question) === "") {
                            formData.set(question, '0'); // Corrected to set values directly for questions without responses
                        }
                    });
                });

                // Calculate initial scores and counts for answered questions
                formData.forEach((value, key) => {
                    Object.keys(domainQuestions).forEach(domain => {
                        if (domainQuestions[domain].includes(key)) { // Updated to check inclusion in the domain's questions list
                            let intValue = parseInt(value);
                            if (intValue > 0) {
                                domainScores[domain] += intValue;
                                domainCounts[domain]++;
                            }
                        }
                    });
                });

                // Calculate averages for each domain
                let domainAverages = {};
                Object.keys(domainScores).forEach(domain => {
                    domainAverages[domain] = domainCounts[domain] > 0 ? domainScores[domain] / domainCounts[domain] : 0;
                });

                // Reset scores and counts for the final calculation
                Object.keys(domainScores).forEach(domain => {
                    domainScores[domain] = 0;
                    domainCounts[domain] = 0;
                });

                // Calculate final scores using real values or averages for unanswered questions
                formData.forEach((value, key) => {
                    Object.keys(domainQuestions).forEach(domain => {
                        if (domainQuestions[domain].includes(key)) { // Updated to check inclusion again for final calculation
                            let intValue = parseInt(value);
                            if (intValue > 0) {
                                domainScores[domain] += intValue;
                            } else {
                                domainScores[domain] += domainAverages[domain]; // Add the average score if no response
                            }
                            domainCounts[domain]++;
                        }
                    });
                });


                // Check if all domains are answered

                if (Object.values(domainScores).every(score => score > 0)) {

                    // Calculate total minimum and maximum scores dynamically
                    let minScore = 0;
                    let maxScore = 0;

                    Object.keys(domainQuestions).forEach(domain => {
                        domainQuestions[domain].forEach(question => {
                            minScore += 1; // Minimum score is 1 per question
                            const options = document.querySelectorAll(`input[name="${question}"]`);
                            maxScore += options.length; // Number of options is the max score for that question
                        });
                    });

                    // Calculate KCCQ Score

                    let sumScores = Object.values(domainScores).reduce((total, score) => total + score, 0);
                    let kccqScore = Math.round((sumScores - minScore) / (maxScore - minScore) * 100)

                    // Generate result HTML
                    let resultHTML = `Il suo punteggio KCCQ è: <b>${kccqScore}</b><br>`;

                    /*   
                    // Print scores for each domain
                    Object.keys(domainScores).forEach(domain => {
                        let average = domainCounts[domain] > 0 ? domainScores[domain] / domainCounts[domain].toFixed(2) : 'N/A';
                        resultHTML += `<b>${domain.replace(/_/g, ' ')} Score: ${domainScores[domain].toFixed(2)} (Average: ${average})</b><br>`;
                    });
                    */

                    resultBox.innerHTML = resultHTML;
                    resultBox.style.display = 'block';
                    resultBox.classList.add('alert-success');
                    resultBox.classList.remove('alert-danger');

                } else {

                    resultBox.innerHTML = '<b>Errore</b>: è necessario che lei risponda a più domande per calcolare il suo punteggio KCCQ.';
                    resultBox.style.display = 'block';
                    resultBox.classList.remove('alert-success');
                    resultBox.classList.add('alert-danger');

                }

            });

        });

    </script>
</head>

<body>
    <div class="container mb-3">
        <h1 class="mt-5">Questionario sullo scompenso cardiaco</h1>
        <p class="lead">Le seguenti domande si riferiscono al suo scompenso cardiaco e a come esso influisce sulla sua
            vita. Per cortesia legga e completi le seguenti domande. Non ci sono risposte giuste o sbagliate. Selezioni
            la risposta che meglio descrive la sua situazione.</p>
        <form id="questionnaire-form">
            <div id="questions-container"></div>
            <div id="result-box" class="alert" style="display: none;"></div>
            <button type="submit" class="btn btn-primary">Calcola Punteggio</button>
        </form>
    </div>
    <div class="container mt-4 small">
        <h4>Riferimenti:</h4>
        <p>Green CP, Porter CB, Bresnahan DR, Spertus JA. Development and evaluation of the Kansas City Cardiomyopathy
            Questionnaire: a new health status measure for heart failure. J Am Coll Cardiol. 2000 Apr;35(5):1245-55.
            doi: 10.1016/s0735-1097(00)00531-3. PMID: 10758967.</p>
        <p>Miani D, Rozbowsky P, Gregori D, Pilotto L, Albanese MC, Fresco C, Fioretti PM. The Kansas City
            Cardiomyopathy Questionnaire: Italian translation and validation. Ital Heart J. 2003 Sep;4(9):620-6. PMID:
            14635380.</p>
        <p>Tutti i diritti riservati ai rispettivi autori.</p>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>
